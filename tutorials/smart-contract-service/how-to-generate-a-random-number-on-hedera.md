# How to Generate a Random Number on Hedera

<figure><img src="../../.gitbook/assets/Screen Shot 2021-12-01 at 2.26.12 PM (1).png" alt=""><figcaption></figcaption></figure>

## Summary

Pseudorandom numbers are used in applications like lotteries, gaming, and even random selection in NFT sales/giveaways. In some cases, it is necessary to prove to third parties that a random number was generated without the influence or control of a user/application.

With Hedera, you have a transaction and Solidity library available to generate pseudorandom numbers with just a few lines of code. This means that when your application generates a random number, anyone can verify that the number was truly generated by the Hedera network â€“ without being influenced by any one user.

In this tutorial, you will learn how to generate random numbers on Hedera using the JavaScript SDK and Solidity. Keep in mind that the random number generator covered here is secure enough for practical applications, but you should carefully consider whether it is secure enough for your specific purpose. For details on limitations and security considerations, see [HIP-351](https://hips.hedera.com/hip/hip-351) (special mention and thanks to LG Electronics for the help and input formulating this Hedera Improvement Proposal).

By the way, [this resource](https://www.wolfssl.com/true-random-vs-pseudorandom-number-generation/) is helpful if you want to learn more about the difference between pseudorandom and random numbers. For simplicity, weâ€™ll use both terms interchangeably throughout this tutorial.

## **Try It Yourself**

* Get a [Hedera testnet account](https://portal.hedera.com/register)
  * This portal acts like a faucet, giving you 10,000 test HBAR every 24 hours
  * If youâ€™re new to Hedera, check out [these steps to setup your development environment](https://docs.hedera.com/guides/getting-started/environment-set-up)
* Use [this Codesandbox](https://codesandbox.io/s/hedera-example-random-number-y9q48r?file=/index.js) to try the example
  * Fork the sandbox
  * Remember to provide testnet account credentials in the .env file
  * Open a new terminal to execute index.js
* Get the [example code from GitHub](https://github.com/ed-marquez/hedera-example-random-number/blob/master/index.js)

## **You Will Use These Tools**

* Hedera JavaScript SDK ([Documentation](https://docs.hedera.com/guides/docs/sdks))
* Solidity and libraries for random number generation ([HIP-351](https://hips.hedera.com/hip/hip-351))
* Mirror node REST API ([Learn More](https://hedera.com/blog/how-to-look-up-transaction-history-on-hedera-using-mirror-nodes-back-to-the-basics))
* Mirror node explorer ([HashScan](https://hashscan.io/#/mainnet/dashboard))

## **Follow These Steps**

1. Generate a random number using the SDK
2. Generate a random number using Solidity

In this scenario, the Operator is the only account involved in submitting transactions to the Hedera network. In step 2, you deploy a smart contract to generate the random number. After completing all steps, your console should look something like this:

![](https://images.hedera.com/Random-Number-Image-1.png?w=5826\&auto=compress%2Cformat\&fit=crop\&dm=1670275995\&s=a6a36c084e8cc5a2f60169645d74abf4)

## **1. Generate a Random Number Using the SDK**

Your testnet credentials from the [Hedera portal](https://portal.hedera.com/register) should be used for the operator variables, which are used to initialize the Hedera client that submits transactions to the network and gets confirmations.

* The constants _**lo**_ and _**hi**_ are the lower and upper limits for the random number, respectively
* Generate a random number (_**randomNum**_) 5 times with a _**for loop**_
  * Use [**PrngTransaction()**](https://docs.hedera.com/guides/docs/sdks/pseudorandom-number-generator) in the SDK to create a transaction that generates a pseudorandom number
  * If a positive value is provided to the _**setRange()**_ method, then the transaction record will contain a 32-bit pseudorandom integer that is equal or greater than 0 and less than _**hi**_
  * If a range is not specified, then the transaction record contains the 384-bit array of pseudorandom bits
* The _**client**_ is used to execute the transaction and obtain the transaction record
* Output to the console the random number for each loop run

{% tabs %}
{% tab title="JavaScript" %}
```javascript
// STEP 1 ===================================
console.log(`\nSTEP 1 ===================================\n`);
console.log(`- Generating random numbers with the SDK...\n`);

const lo = 0;
const hi = 50;

let randomNum = [];
for (var i = 0; i < 5; i++) {
    const randomNumTx = await new PrngTransaction().setRange(hi).execute(client);
    const randomNumRec = await randomNumTx.getRecord(client);
    randomNum[i] = randomNumRec.prngNumber;
    console.log(`- Run #${i + 1}: Random number = ${randomNum[i]}`);
}
```
{% endtab %}
{% endtabs %}

**Console Output:**

```
STEP 1 ===================================
- Generating random numbers with the SDK...
- Run #1: Random number = 10
- Run #2: Random number = 7
- Run #3: Random number = 14
- Run #4: Random number = 44
- Run #5: Random number = 27
```

## **2. Generate a Random Number Using Solidity**

### 2.1 Deploy the Contract

In the index.js file:

* Set the gas limit (_**gasLim**_) to be 4,000,000 and define the contract _**bytecode**_
* Deploy the contract using the helper function _**contracts.deployContractFcn**_
  * The function returns the _**contractId**_ in Hedera format and _**contractAddress**_ in Solidity format
  * The inputs are the _**bytecode**_, _**gasLim**_, and _**client**_
* Output to the console _**contractId**_ and _**contractAddress**_

You can see the Solidity contract _**PrngSystemContract**_ in the second tab below. This example calls a precompiled contract with address 0x169. For additional details about the contract and the functions _**getPseudorandomSeed**_ and _**getPseudorandomNumber**_, check out [HIP-351](https://hips.hedera.com/hip/hip-351). The first function generates a 256-bit pseudorandom seed and returns the corresponding bytes; you can then use that seed to get a random number. The second function operates on those bytes to return the random number. There is also a contract function _**getNumber**_ which reads the random number from the contract state variable, _**randNum**_.

{% tabs %}
{% tab title="JavaScript" %}
```javascript
// STEP 2 ===================================
console.log(`\nSTEP 2 ===================================\n`);
console.log(`- Generating random number with Solidity...\n`);

// Deploy the Solidity contract
let gasLim = 4000000;
const bytecode = contract.object;
const [contractId, contractAddress] = await contracts.deployContractFcn(bytecode, gasLim, client);
console.log(`- Contract ID: ${contractId}`);
console.log(`- Contract ID in Solidity address format: ${contractAddress}`);
```
{% endtab %}
{% endtabs %}

{% tabs %}
{% tab title="Solidity" %}
```solidity
// SPDX-License-Identifier: Apache-2.0
pragma solidity >=0.4.9 <0.9.0;

import "./IPrngSystemContract.sol";

contract PrngSystemContract {
    address constant PRECOMPILE_ADDRESS = address(0x169);
    uint32 randNum;

    function getPseudorandomSeed() external returns (bytes32 randomBytes) {
        (bool success, bytes memory result) = PRECOMPILE_ADDRESS.call(
            abi.encodeWithSelector(IPrngSystemContract.getPseudorandomSeed.selector));
        require(success);
        randomBytes = abi.decode(result, (bytes32));
    }

    /**
     * Returns a pseudorandom number in the range [lo, hi) using the seed generated from "getPseudorandomSeed"
     */
    function getPseudorandomNumber(uint32 lo, uint32 hi) external returns (uint32) {
        (bool success, bytes memory result) = PRECOMPILE_ADDRESS.call(
            abi.encodeWithSelector(IPrngSystemContract.getPseudorandomSeed.selector));
        require(success);
        uint32 choice;
        assembly {
            choice := mload(add(result, 0x20))
        }
        randNum = lo + (choice % (hi - lo));
        return randNum;
    }

    function getNumber() public view returns (uint32) {
        return randNum;
    }
}
```
{% endtab %}
{% endtabs %}

**Helper Functions:**

The function _**contracts.deployContractFcn**_ uses [**ContractCreateFlow()**](https://docs.hedera.com/guides/docs/sdks/smart-contracts/create-a-smart-contract#contractcreateflow) to store the bytecode and deploy the contract on Hedera. This single call handles for you the operations [**FileCreateTransaction()**](https://docs.hedera.com/guides/docs/sdks/file-storage/create-a-file), [**FileAppendTransaction()**](https://docs.hedera.com/guides/docs/sdks/file-storage/append-to-a-file), and [**ContractCreateTransaction()**](https://docs.hedera.com/guides/docs/sdks/smart-contracts/create-a-smart-contract#contractcreatetransaction). This helper function simplifies the contract deployment process and is reusable in case you need to create more contracts in the future.

```javascript
export async function deployContractFcn(bytecode, gasLim, client) {
    const contractCreateTx = new ContractCreateFlow().setBytecode(bytecode).setGas(gasLim);
    const contractCreateSubmit = await contractCreateTx.execute(client);
    const contractCreateRx = await contractCreateSubmit.getReceipt(client);
    const contractId = contractCreateRx.contractId;
    const contractAddress = contractId.toSolidityAddress();
    return [contractId, contractAddress];
}
```

### 2.2 Execute the Contract

* Use the helper _**contracts.executeContractFcn**_ to execute the contract function _**getPseudorandomNumber**_
  * Use **ContractFunctionParameters()** from the SDK to specify the parameters for the contract function (_**randNumParams**_). Pass the lower (_**lo**_) and upper (_**hi**_) limits for the random number
  * The inputs are the contract ID (_**contractId**_), the contract function to execute, _**randNumParams**_, _**gasLim,**_ and _**client**_
  * The contract function calls a precompiled contract and gets the bytes for the random seed. The random number is calculated, stored in the state variable _**randNum**_, and returned by the function
  * The helper function returns the record object of the transaction (_**randNumRec**_), which is used to obtain the status of the transaction
* Output to the console:
  * The status of the contract call

![Code Snippet Background](https://images.hedera.com/CodeSnippetBackground.jpg?w=3360\&auto=compress%2Cformat\&fit=crop\&dm=1670269159\&s=fc2790f0ebef705338b7fae7db54cf9d)

```javascript
// Execute the contract
const randNumParams = new ContractFunctionParameters().addUint32(lo).addUint32(hi);
const randNumRec = await contracts.executeContractFcn(contractId, "getPseudorandomNumber", randNumParams, gasLim, client);
console.log(`- Contract execution: ${randNumRec.receipt.status} \n`);
```

**Helper Functions:**

The function _**contracts.executeContractFcn**_ uses [**ContractExecuteTransaction()**](https://docs.hedera.com/guides/docs/sdks/smart-contracts/call-a-smart-contract-function) in the SDK to call the specified contract function.

![Code Snippet Background](https://images.hedera.com/CodeSnippetBackground.jpg?w=3360\&auto=compress%2Cformat\&fit=crop\&dm=1670269159\&s=fc2790f0ebef705338b7fae7db54cf9d)

```javascript
export async function executeContractFcn(cId, fcnName, params, gasLim, client) {
    const contractExecuteTx = new ContractExecuteTransaction().setContractId(cId).setGas(gasLim).setFunction(fcnName, params);
    const contractExecuteSubmit = await contractExecuteTx.execute(client);
    const contractExecuteRec = await contractExecuteSubmit.getRecord(client);
    return contractExecuteRec;
}
```

### 2.3 Get the Results â€“ Query the Transaction Record, Call a Contract Function, and Check a Mirror Node Explorer

You will learn various ways to obtain the random number from the Solidity contract. The best approach depends on your use case and preference. You can get the random number by: using a transaction record, doing a contract call to read state variables, and checking a mirror node explorer.

* Use the helper function _**queries.txRecQueryFcn**_ to obtain information from the transaction record
  * The function returns a record query object (_**recQuery**_)
  * The inputs are the ID of the relevant transaction from the record object (_**randNumRec.transactionId**_) and _**client**_
  * The query of the transaction record, _**recQuery**_, was configured to return information on child transactions. Thus, the first child transaction of the contract execution (parent transaction) contains information about the bytes needed for the random number â€“ see _**recQuery.children\[0].prngBytes**_
    * The random number is obtained from doing a modulo operation (%) of the integer value of the last four bytes and the specified range
* Use the helper _**contracts.callContractFcn**_ to call the contract function _**getNumber**_, which reads the random number from a state variable in the contract
  * The inputs are _**contractId**_, the contract function to call, _**gasLim**_, and _**client**_
  * The helper function returns _**randNumResult**_, which is used to obtain the random number
* Use the helper function _**queries.mirrorTxQueryFcn**_ to obtain transaction information from the mirror nodes
  * The function returns a [mirror node REST API](https://hedera.com/blog/how-to-look-up-transaction-history-on-hedera-using-mirror-nodes-back-to-the-basics) request about the relevant transaction (_**randNumInfo**_) and a string with a mirror explorer URL (_**randNumExpUrl**_)
  * The input is the ID of the relevant transaction from the record object (_**randNumRec.transactionId**_)
* Output to the console:
  * The random number obtained using both the transaction record and using the contract function
  * A message indicating if the random number obtained with the two methods above matches or not
  * The mirror node explorer URL with more details about the transaction

The last step is to [**join the Hedera Developer Discord!**](https://hedera.com/discord)

![Code Snippet Background](https://images.hedera.com/CodeSnippetBackground.jpg?w=3360\&auto=compress%2Cformat\&fit=crop\&dm=1670269159\&s=fc2790f0ebef705338b7fae7db54cf9d)

```javascript
// Query the transaction record to get the random number from bytes
const recQuery = await queries.txRecQueryFcn(randNumRec.transactionId, client);

let lowOrderBytes = new Uint8Array(recQuery.children[0].prngBytes).slice(28, 32);
let dataview = new DataView(lowOrderBytes.buffer);
let range = hi - lo;
let int32be = dataview.getUint32(0);
let randNum = int32be % range;
console.log(`- The random number (using transaction record) = ${randNum}`);

// Call the contract to read random number using the getNumber function
const randNumResult = await contracts.callContractFcn(contractId, "getNumber", gasLim, client);
console.log(`- The random number (using contract function) = ${randNumResult.getUint32(0)}`);
randNum === randNumResult.getUint32(0) ? console.log(`- The random number checks out âœ…`) : console.log(`- Random number doesn't match âŒ`);

// Check a Mirror Node Explorer
const [randNumInfo, randNumExpUrl] = await queries.mirrorTxQueryFcn(randNumRec.transactionId);
console.log(`\n- See details in mirror node explorer: \n${randNumExpUrl}`);

console.log(`
====================================================
 THE END - NOW JOIN: https://hedera.com/discord
====================================================\n`);
}
```

**Helper Functions**

The function _**queries.txRecordQueryFcn**_ uses [**TransactionRecordQuery()**](https://docs.hedera.com/guides/docs/sdks/transactions/get-a-transaction-record) in the SDK to obtain details about the contract execution transaction. Note that the ._**setIncludeChildren**_ method is set to true to get information about all the children transactions under the contract execution â€“ this includes the transaction generating the random number.

The function _**contracts.callContractFcn**_ uses [**ContractCallQuery()**](https://docs.hedera.com/guides/docs/sdks/smart-contracts/call-a-smart-contract-function-1) in the SDK to call a contract function that reads a state variable containing the random number.

The function _**queries.mirrorTxQueryFcn**_ obtains transaction information from the mirror nodes. The function introduces a delay of 10 seconds to allow for the propagation of information to the mirror nodes. It then formats the transaction ID and performs string operations to return a mirror REST API query and a mirror node explorer URL.

```javascript
export async function txRecQueryFcn(txId, client) {
    const recQuery = await new TransactionRecordQuery().setTransactionId(txId).setIncludeChildren(true).execute(client);
    return recQuery;
}
```

```javascript
export async function callContractFcn(cId, fcnName, gasLim, client) {
    const contractCallTx = new ContractCallQuery().setContractId(cId).setGas(gasLim).setFunction(fcnName);
    const contractCallSubmit = await contractCallTx.execute(client);
    return contractCallSubmit;
}
```

```javascript
export async function mirrorTxQueryFcn(txIdRaw) {
    // Query a mirror node for information about the transaction
    const delay = (ms) => new Promise((res) => setTimeout(res, ms));
    await delay(10000); // Wait for 10 seconds before querying a mirror node

    const txIdPretty = prettify(txIdRaw.toString());
    const mirrorNodeExplorerUrl = `https://hashscan.io/testnet/transaction/${txIdPretty}`;
    const mirrorNodeRestApi = `https://testnet.mirrornode.hedera.com/api/v1/transactions/${txIdPretty}`;
    let mQuery = [];
    try {
        mQuery = await axios.get(mirrorNodeRestApi);
    } catch {}
    return [mQuery, mirrorNodeExplorerUrl];
}

function prettify(txIdRaw) {
    const a = txIdRaw.split("@");
    const b = a[1].split(".");
    return `${a[0]}-${b[0]}-${b[1]}`;
}
```

**Console Output:**

```
STEP 2 ===================================
- Generating random number with Solidity...
- Contract ID: 0.0.49020098
- Contract ID in Solidity address format: 0000000000000000000000000000000002ebfcc2
- Contract execution: SUCCESS
- The random number (using transaction record) = 14
- The random number (using contract function) = 14
- The random number checks out âœ…
- See details in mirror node explorer:

https://hashscan.io/testnet/transaction/0.0.2520793-1670012876-681938430

====================================================
ðŸŽ‰ðŸŽ‰ THE END - NOW JOIN: 
https://hedera.com/discord

====================================================
```

## **Summary**

Now you know how to generate a random number on Hedera using the JavaScript SDK and Solidity libraries. You can try this example with the other officially supported SDKs for Java, Go, and Swift.
